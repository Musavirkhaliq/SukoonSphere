import{w as A,r as l,j as e,U as B,x as E,at as $,au as I,D as T,t as r,f as i}from"./index-B4x1u1U0.js";import z from"./ArticleCommentReply-CINRzewn.js";const U=({comment:s,articleId:M,onCommentUpdate:n})=>{var g;const{user:a}=A(),[c,b]=l.useState(!1),[h,o]=l.useState(!1),[d,u]=l.useState(""),[v,p]=l.useState(!1),[y,x]=l.useState(s.content),[w,m]=l.useState(!1),[N,f]=l.useState(!1),C=async()=>{if(!a){r.error("Please login to like comments!");return}try{await i.patch(`/articles/comments/${s._id}/like`),n()}catch{r.error("Failed to like comment")}},R=()=>{if(!a||a._id!==s.createdBy._id){r.error("You can only edit your own comments!");return}p(!0)},S=async()=>{if(!y.trim()){r.error("Comment cannot be empty!");return}try{await i.patch(`/articles/comments/${s._id}`,{content:y}),p(!1),n(),r.success("Comment updated successfully")}catch{r.error("Failed to update comment")}},k=()=>{m(!0)},_=async()=>{f(!0);try{await i.delete(`/articles/comments/${s._id}`),n(),r.success("Comment deleted successfully"),m(!1)}catch{r.error("Failed to delete comment")}finally{f(!1)}},D=async()=>{var t,j;if(!a){r.error("Please login to reply!");return}if(!d.trim()){r.error("Reply cannot be empty!");return}try{await i.post(`/articles/comments/${s._id}/replies`,{content:d,replyToUserId:s.createdBy._id}),u(""),o(!1),n(),r.success("Reply added successfully")}catch(F){r.error(((j=(t=F.response)==null?void 0:t.data)==null?void 0:j.msg)||"Failed to add reply")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(B,{createdBy:s.createdBy.name,username:s.createdBy.name,userAvatar:s.createdBy.avatar,createdAt:s.createdAt,size:"verySmall"})}),a&&a._id===s.createdBy._id&&e.jsx(E,{handleEdit:R,handleDelete:k})]}),v?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:y,onChange:t=>x(t.target.value),className:"w-full p-3 pr-14 border border-gray-100 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent resize-none text-gray-700",rows:"3"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>{p(!1),x(s.content)},className:"btn-red !py-1",children:"Cancel"}),e.jsx("button",{onClick:S,className:"btn-2 !py-1",children:"Save"})]})]}):e.jsx("p",{className:"mt-2",children:s.content}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm",children:[e.jsxs("button",{onClick:C,className:`flex items-center gap-1 ${a&&s.likes.includes(a._id)?"text-primary":"text-gray-500"}`,children:[e.jsx($,{}),e.jsx("span",{children:s.likes.length})]}),e.jsxs("button",{onClick:()=>o(!h),className:"flex items-center gap-1 text-gray-500 hover:text-primary",children:[e.jsx(I,{}),"Reply"]})]}),h&&e.jsxs("div",{className:"mt-4",children:[e.jsx("textarea",{value:d,onChange:t=>u(t.target.value),placeholder:"Write your reply...",className:"w-full p-3 pr-14 border border-gray-100 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent resize-none text-gray-700",rows:"2"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>{o(!1),u("")},className:"btn-red !py-1",children:"Cancel"}),e.jsx("button",{onClick:D,className:"btn-2 !py-1",children:"Reply"})]})]}),((g=s.replies)==null?void 0:g.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:()=>b(!c),className:"text-primary text-sm",children:c?"Hide Replies":`Show ${s.replies.length} ${s.replies.length===1?"Reply":"Replies"}`}),c&&e.jsx("div",{className:"ml-4 mt-2 space-y-3",children:s.replies.map(t=>e.jsx(z,{reply:t,commentId:s._id,onReplyUpdate:n},t._id))})]})]}),e.jsx(T,{isOpen:w,onClose:()=>m(!1),onDelete:_,title:"Delete Comment",message:"Are you sure you want to delete this comment? This will also delete all replies to this comment.",itemType:"comment",isLoading:N})]})};export{U as default};
