import{r as n,g as oe,h as ce,j as e,L as de,i as U,k as me,l as xe,m as B,B as O,n as he,o as ue,p as pe,q as fe,s as ge,f as z,t as H}from"./index-BlL4GbOm.js";import{F as R}from"./index-CMxdRV0b.js";import ve from"./SimilarArticles-jtGUmYp1.js";import je from"./CommentPopup-sOADVF0F.js";import"./ArticleComments-F_iHINdt.js";import"./ArticleCommentCard-D35c9y1s.js";import"./ArticleCommentReply-BK5BojtR.js";const Le=()=>{var P;const[a,j]=n.useState(null),[G,y]=n.useState(!0),[N,w]=n.useState(null),[m,h]=n.useState(!1),[b,ye]=n.useState(null),[c,k]=n.useState("female"),{id:u}=oe(),[S,W]=n.useState([]),[p,g]=n.useState(!1),[_,q]=n.useState([]),[C,T]=n.useState(!1),[J,E]=n.useState(0),[Q,K]=n.useState(0),[Y,L]=n.useState(!1),[v,F]=n.useState(!1),X=ce(),$=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").trim();n.useEffect(()=>{(async()=>{var r;try{y(!0);const s=await z.get(`articles/${u}`),i=s.data.article;j(i),q(s.data.similarArticles),E(((r=i.likes)==null?void 0:r.length)||0);const d=JSON.parse(localStorage.getItem("user"));d&&i.likes&&T(i.likes.includes(d._id)),w(null)}catch(s){w("Failed to load article. Please try again later."),console.error("Error fetching article:",s)}finally{y(!1)}})()},[u]);const Z=async()=>{if(!JSON.parse(localStorage.getItem("user"))){H.error("Please login to like this article!"),X("/auth/sign-up");return}if(!v){F(!0);try{const s=(await z.patch(`articles/${u}/like`)).data.article;T(!C),E(s.likes.length),j(i=>({...i,likes:s.likes}))}catch(r){console.error("Error liking article:",r),H.error("Failed to like article. Please try again.")}finally{F(!1)}}},A=()=>{const t=document.documentElement.scrollHeight-window.innerHeight,r=window.scrollY/t*100;K(r)};n.useEffect(()=>(window.addEventListener("scroll",A),()=>{window.removeEventListener("scroll",A)}),[]),n.useEffect(()=>{if(a!=null&&a.content){const t=Array.from(document.querySelectorAll(".article-body h1, .article-body h2"));t.forEach(s=>{if(!s.id){const i=$(s.innerText);s.id=i}});const r=t.map(s=>({text:s.innerText,slug:s.id||$(s.innerText)}));W(r)}},[a]),n.useEffect(()=>{const t=window.speechSynthesis;return()=>{b&&t.cancel()}},[b]);const M=t=>{try{return t.replace(/<div class="flex-shrink-0 flex flex-col relative items-end">[\s\S]*?<div class="relative p-1 rounded-sm flex items-center justify-center bg-token-main-surface-primary text-token-text-primary h-8 w-8">/,"").replace(/<\/div>\s*<\/div>\s*<\/div>\s*<\/div>$/,"").trim()}catch(r){return console.error("Error cleaning content:",r),t}},ee=t=>{const s=t.replace(/<[^>]*>/g,"").split(/\s+/).length;return Math.ceil(s/200)},te=()=>{const t=window.speechSynthesis;if(m){t.cancel(),h(!1);return}const r=t.getVoices(),s=["Microsoft David Desktop","Google UK English Male","Microsoft David","en-GB-Standard-B","en-US-Standard-B"],i=r.find(l=>{const o=l.name.toLowerCase();return c==="male"?s.some(D=>o.includes(D.toLowerCase())):o.includes("female")||o.includes("zira")||o.includes("helena")})||r.find(l=>{const o=l.name.toLowerCase();return c==="male"?o.includes("male")||o.includes("david"):o.includes("female")||o.includes("zira")})||r[0],d=document.createElement("div");d.innerHTML=M(a.content);const f=(d.textContent||d.innerText||"").match(/[^.!?]+[.!?]+/g)||[];let x=0;const V=()=>{if(x<f.length){const l=new SpeechSynthesisUtterance(f[x]);i&&(l.voice=i);const o=f[x],re=o.endsWith("?")||o.endsWith("!")||o.endsWith(":")?400:200;c==="male"?(l.pitch=.95,l.rate=.98,l.volume=1):(l.pitch=1.1,l.rate=.95,l.volume=1);const ne=Math.random()*.1-.05,le=Math.random()*.1-.05;l.pitch+=ne,l.rate+=le,l.onend=()=>{x++,x<f.length?setTimeout(()=>V(),re):h(!1)},l.onerror=ie=>{console.error("Speech synthesis error:",ie),h(!1)},t.speak(l)}};h(!0),V()},I=()=>{g(!p)},se=(t,r)=>{t.preventDefault();const s=document.getElementById(r);s?(s.scrollIntoView({behavior:"smooth"}),g(!1)):console.error(`Element with id '${r}' not found`)};if(G)return e.jsx(de,{});if(N)return e.jsx("div",{className:"min-h-[60vh] flex flex-col items-center justify-center",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-lg max-w-md text-center",children:[e.jsx(U,{className:"w-8 h-8 mx-auto mb-3 text-red-500"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Error"}),e.jsx("p",{children:N})]})});if(!a)return e.jsx("div",{className:"min-h-[60vh] flex flex-col items-center justify-center",children:e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-6 py-4 rounded-lg max-w-md text-center",children:[e.jsx(U,{className:"w-8 h-8 mx-auto mb-3 text-yellow-500"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Article Not Found"}),e.jsx("p",{children:"The article you're looking for doesn't exist or has been removed."})]})});const ae=ee(a.content);return e.jsxs("div",{className:"relative bg-white",children:[e.jsx("div",{className:"lg:hidden fixed top-0 left-0 right-0 z-[60] bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("button",{onClick:I,className:"flex items-center gap-2 text-[var(--primary) hover:text-ternary transition-colors duration-200","aria-label":"Toggle Table of Contents",children:[p?e.jsx(me,{className:"w-5 h-5"}):e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Contents"})]}),e.jsx("h3",{className:"text-sm font-medium text-[var(--grey--800)] truncate max-w-[200px]",children:a.title})]})}),e.jsx("div",{className:`lg:hidden overflow-x-hidden fixed top-[50px] left-0 right-0 z-50 bg-white  transform transition-transform duration-300 ease-in-out ${p?"translate-y-0":"-translate-y-full"}`,children:e.jsx("div",{className:"px-6 max-h-[70vh] overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"table-of-contents",children:[e.jsx("h2",{className:"hidden text-xl font-bold mb-6 lg:flex items-center justify-between gap-3 text-[var(--primary)]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"text-[var(--primary)] "}),"Quick Navigation"]})}),e.jsx("nav",{className:"toc-nav",children:e.jsx("ol",{className:"space-y-4",children:S.map((t,r)=>e.jsx("li",{className:"group",children:e.jsxs("a",{href:`#${t.slug}`,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-all duration-200",onClick:s=>{s.preventDefault();const i=document.getElementById(t.slug);i?(i.scrollIntoView({behavior:"smooth"}),g(!1)):console.error(`Element with id '${t.slug}' not found.`)},children:[e.jsx(R,{className:"text-ternary w-4 h-4 group-hover:translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"text-gray-700 group-hover:text-ternary transition-colors duration-200 font-medium",children:t.text})]})},r))})})]})})}),e.jsx("div",{className:`lg:hidden overflow-x-hidden fixed inset-0 bg-black/50 z-30 transition-opacity duration-300 ${p?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:I}),e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-6 lg:gap-12",children:[e.jsxs("article",{className:"col-span-12 lg:col-span-8 order-2 lg:order-1 mt-4 lg:mt-8",children:[e.jsxs("header",{className:"max-w-4xl mx-auto px-4 py-4 space-y-3 border-b-2 border-gray-200",children:[e.jsx("h2",{className:"text-3xl font-bold leading-tight text-gray-900",children:a.title||"Every book I read in 2024, with commentary"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between py-4 space-y-6 md:space-y-0",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:a==null?void 0:a.authorAvatar,alt:a==null?void 0:a.authorName,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium md:font-semibold text-sm md:text-base text-[var(--primary)]",children:((P=a==null?void 0:a.author)==null?void 0:P.name)||(a==null?void 0:a.authorName)||"Anonymous"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--grey--800)]",children:[e.jsxs("span",{children:[ae||"10"," min read"]}),e.jsx("span",{children:"Â·"}),e.jsx("span",{children:new Date(a.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})}),e.jsx("div",{className:"flex items-center gap-6 mt-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`meta-item upvote-button ${v?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:Z,children:[e.jsx("div",{className:"flex items-center justify-center gap-2 w-8 h-8 rounded-full border border-gray-300 hover:border-gray-400 transition-colors",children:v?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[var(--primary)]"}):C?e.jsx(O,{className:"meta-icon liked text-[var(--ternery)]"}):e.jsx(O,{className:"meta-icon text-[var(--primary)]"})}),e.jsx("span",{className:"text-sm text-[var(--grey--800)]",children:J})]}),e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center gap-2 text-[var(--grey--800)] hover:text-[var(--ternery)]",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:a.totalComments||0})]}),e.jsxs("div",{className:"inline-flex items-center rounded-full shadow-sm hover:shadow-md transition-all duration-300 p-1",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>k("female"),className:`flex items-center justify-center rounded-full w-8 h-8 transition-all duration-300 ${c==="female"?"bg-pink-500 text-white scale-110":"text-pink-500 hover:bg-pink-50"}`,title:"Female Voice",children:e.jsx(ue,{className:`w-4 h-4 ${c==="female"?"animate-pulse":""}`})}),e.jsx("button",{onClick:()=>k("male"),className:`flex items-center justify-center rounded-full w-8 h-8 transition-all duration-300 ${c==="male"?"bg-blue-500 text-white scale-110":"text-blue-500 hover:bg-blue-50"}`,title:"Male Voice",children:e.jsx(pe,{className:`w-4 h-4 ${c==="male"?"animate-pulse":""}`})})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 mx-1 h-6 self-center"}),e.jsx("button",{onClick:te,className:`flex items-center justify-center space-x-2 px-4 py-1.5 rounded-full transition-all duration-300 ${m?"bg-red-500 text-white hover:bg-red-600":"bg-[var(--primary)] text-white hover:bg-[var(--primary)]/90"}`,title:m?"Stop Reading":"Start Reading",children:e.jsx("div",{className:"flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Stop"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:`w-4 h-4 ${!m&&c?"animate-bounce":""}`}),e.jsx("span",{className:"text-sm font-medium",children:"Listen"})]})})})]})]})})]})]}),e.jsx("div",{className:"progress-bar",style:{width:`${Q}%`}}),e.jsx("div",{className:"article-body prose prose-lg max-w-none",dangerouslySetInnerHTML:{__html:M(a.content)}})]}),e.jsx("section",{className:"hidden lg:block col-span-12 lg:col-span-4 order-1 lg:order-2",children:e.jsx("div",{className:"sticky top-14 bg-white rounded-xl shadow-md p-6",children:e.jsxs("div",{className:"table-of-contents",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-3 text-[var(--primary)] ",children:[e.jsx(B,{className:"text-[var(--primary)] "}),"Quick Navigation"]}),e.jsx("nav",{className:"toc-nav max-h-[60vh] overflow-y-auto custom-scrollbar",children:e.jsx("ol",{className:"space-y-3 pr-4",children:S.map((t,r)=>e.jsx("li",{className:"group",children:e.jsxs("a",{href:`#${t.slug}`,className:"flex items-center gap-3 rounded-lg hover:bg-gray-50 transition-all duration-200",onClick:s=>se(s,t.slug),children:[e.jsx(R,{className:"text-ternary w-4 h-4 group-hover:translate-x-1 transition-transform duration-300"}),e.jsx("span",{className:"text-gray-700 group-hover:text-ternary transition-colors duration-200 font-medium",children:t.text})]})},r))})})]})})})]}),e.jsx("div",{className:"mt-12",children:e.jsx(ve,{similarArticles:_})})]}),e.jsx(je,{isOpen:Y,onClose:()=>L(!1),articleId:u})]})};export{Le as default};
