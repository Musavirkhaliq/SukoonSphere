import{G as C,w as M,r,a as k,b as I,f as P,j as e,H as U,D as $}from"./index-Gf-_owta.js";const _=()=>{var j,w;const t=C(),{user:v}=M(),[l,E]=r.useState(""),[h,x]=r.useState(!1),[b,u]=r.useState(!1),[D,F]=r.useState(null),{ref:L,inView:m}=k(),{data:a,fetchNextPage:g,hasNextPage:i,isFetchingNextPage:o,status:p,refetch:f}=I({queryKey:["userPosts",t==null?void 0:t._id],enabled:!!(t!=null&&t._id),queryFn:async({pageParam:s=1})=>(await P.get(`/posts/user/${t._id}?page=${s}&limit=10`)).data,getNextPageParam:s=>s.pagination.hasNextPage?s.pagination.currentPage+1:void 0,refetchOnWindowFocus:!1,refetchOnMount:!1,cacheTime:5*60*1e3});r.useEffect(()=>{m&&i&&!o&&g()},[m,g,i,o]);const y=async()=>{u(!0);try{await P.delete(`/posts/${D}`),await f(),x(!1)}catch(s){console.log(s)}u(!1)},S=async s=>{await f()},c=((a==null?void 0:a.pages.flatMap(s=>s.posts))||[]).filter(s=>{var n,N;return(((n=s.description)==null?void 0:n.toLowerCase())||"").includes(l.toLowerCase())||((N=s.tags)==null?void 0:N.some(d=>((d==null?void 0:d.toLowerCase())||"").includes(l.toLowerCase())))});return p==="loading"?e.jsx("div",{className:"text-center py-4",children:"Loading posts..."}):p==="error"?e.jsx("div",{className:"text-center text-red-500 py-4",children:"Error loading posts"}):e.jsxs("div",{className:"lg:p-6 bg-white rounded-xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-4 lg:mb-8",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Posts ",e.jsx("span",{className:"text-blue-500 ml-2",children:(w=(j=a==null?void 0:a.pages[0])==null?void 0:j.pagination)==null?void 0:w.totalPosts})]})}),c.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:l?"No matching posts found":"No posts yet"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:l?"Try searching with different keywords":"Share your thoughts and experiences with the community!"})]}):e.jsxs("div",{className:"space-y-6",children:[c.map((s,n)=>e.jsx(U,{post:s,user:v,onPostDelete:y,onPostUpdate:S},`${s._id}-${n}`)),e.jsxs("div",{ref:L,className:"py-4 text-center",children:[o&&e.jsx("div",{className:"text-gray-500",children:"Loading more posts..."}),!o&&i&&e.jsx("div",{className:"text-gray-400",children:"Scroll for more"}),!o&&!i&&c.length>0&&e.jsx("div",{className:"text-gray-400",children:"That's all folks! You've reached the end of the posts."})]})]}),h&&e.jsx($,{isOpen:h,closeModal:()=>x(!1),onDelete:y,isDeleting:b,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone."})]})};export{_ as default};
