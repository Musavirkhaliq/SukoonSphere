var q=t=>{throw TypeError(t)};var O=(t,s,o)=>s.has(t)||q("Cannot "+o);var r=(t,s,o)=>(O(t,s,"read from private field"),o?o.call(t):s.get(t)),C=(t,s,o)=>s.has(t)?q("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,o),k=(t,s,o,a)=>(O(t,s,"write to private field"),a?a.call(t,o):s.set(t,o),o),S=(t,s,o)=>(O(t,s,"access private method"),o);import{af as H,ag as J,ah as K,ai as W,aj as G,ak as V,r as d,al as X,am as Z,j as e,p as Q,e as T,an as tt,g as et,ao as st,ap as at,a8 as ot,l as rt,z as lt,aq as it,ar as nt,S as ct,as as dt,at as ht,B as P,k as mt}from"./index-CX54NAfH.js";var y,b,i,p,f,E,R,B,xt=(B=class extends H{constructor(s,o){super();C(this,f);C(this,y);C(this,b);C(this,i);C(this,p);k(this,y,s),this.setOptions(o),this.bindMethods(),S(this,f,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const o=this.options;this.options=r(this,y).defaultMutationOptions(s),J(this.options,o)||r(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,i),observer:this}),o!=null&&o.mutationKey&&this.options.mutationKey&&K(o.mutationKey)!==K(this.options.mutationKey)?this.reset():((a=r(this,i))==null?void 0:a.state.status)==="pending"&&r(this,i).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=r(this,i))==null||s.removeObserver(this)}onMutationUpdate(s){S(this,f,E).call(this),S(this,f,R).call(this,s)}getCurrentResult(){return r(this,b)}reset(){var s;(s=r(this,i))==null||s.removeObserver(this),k(this,i,void 0),S(this,f,E).call(this),S(this,f,R).call(this)}mutate(s,o){var a;return k(this,p,o),(a=r(this,i))==null||a.removeObserver(this),k(this,i,r(this,y).getMutationCache().build(r(this,y),this.options)),r(this,i).addObserver(this),r(this,i).execute(s)}},y=new WeakMap,b=new WeakMap,i=new WeakMap,p=new WeakMap,f=new WeakSet,E=function(){var o;const s=((o=r(this,i))==null?void 0:o.state)??W();k(this,b,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},R=function(s){G.batch(()=>{var o,a,n,h,c,g,w,j;if(r(this,p)&&this.hasListeners()){const m=r(this,b).variables,x=r(this,b).context;(s==null?void 0:s.type)==="success"?((a=(o=r(this,p)).onSuccess)==null||a.call(o,s.data,m,x),(h=(n=r(this,p)).onSettled)==null||h.call(n,s.data,null,m,x)):(s==null?void 0:s.type)==="error"&&((g=(c=r(this,p)).onError)==null||g.call(c,s.error,m,x),(j=(w=r(this,p)).onSettled)==null||j.call(w,void 0,s.error,m,x))}this.listeners.forEach(m=>{m(r(this,b))})})},B);function $(t,s){const o=V(),[a]=d.useState(()=>new xt(o,t));d.useEffect(()=>{a.setOptions(t)},[a,t]);const n=d.useSyncExternalStore(d.useCallback(c=>a.subscribe(G.batchCalls(c)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),h=d.useCallback((c,g)=>{a.mutate(c,g).catch(X)},[a]);if(n.error&&Z(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:h,mutateAsync:n.mutate}}const gt=({onClose:t,user:s,handleProfileUpdate:o})=>{const[a,n]=d.useState(!1),[h,c]=d.useState((s==null?void 0:s.avatar)||null),g=d.useRef(null),w=async u=>{u.preventDefault(),n(!0);const N=new FormData(u.target);try{const v=await o(N);window.location.reload()}catch(v){console.log({errorInModel:v})}finally{n(!1)}},j=u=>{const N=u.target.files[0];if(N){const v=new FileReader;v.onloadend=()=>{c(v.result)},v.readAsDataURL(N)}},m=()=>{var u;(u=g.current)==null||u.click()},x=e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all relative z-50",children:[e.jsx("button",{onClick:t,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsxs("div",{className:"px-6 sm:px-8 py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-[var(--grey--900)]",children:"Update Your Profile"}),e.jsx("p",{className:"text-[var(--grey--800)] mt-2",children:"Customize your profile information"})]}),e.jsxs("form",{method:"post",encType:"multipart/form-data",className:"space-y-6",onSubmit:w,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{onClick:m,className:"relative group cursor-pointer",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-[var(--primary)] shadow-lg",children:h?e.jsx("img",{src:h,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(T,{className:"w-12 h-12 text-gray-400"})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(tt,{className:"w-8 h-8 text-white"})}),e.jsx("input",{ref:g,type:"file",name:"avatar",className:"hidden",accept:"image/*",onChange:j})]}),e.jsx("p",{className:"text-sm text-[var(--grey--800)] mt-2",children:"Click to change profile picture"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"name",required:!0,className:"p-2 bg-[var(--body)] rounded-lg text-black  border border-gray-300 focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent transition-all pl-10",placeholder:"Enter your full name",defaultValue:s==null?void 0:s.name}),e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",disabled:a,children:[e.jsx(Q,{className:"w-4 h-4"}),"Cancel"]}),e.jsx("button",{type:"submit",className:`btn-2 relative flex items-center gap-2 ${a?"cursor-not-allowed opacity-70":""}`,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-4 h-4"}),"Update Profile"]})})]})]})]})]})});return at.createPortal(x,document.body)};function ut(t){return ot({tag:"svg",attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"polygon",attr:{fill:"#42A5F5",points:"36,44 8,44 8,8 28,8 36,16"},child:[]},{tag:"polygon",attr:{fill:"#90CAF9",points:"40,40 12,40 12,4 32,4 40,12"},child:[]},{tag:"polygon",attr:{fill:"#E1F5FE",points:"38.5,13 31,13 31,5.5"},child:[]},{tag:"path",attr:{fill:"#1976D2",d:"M23.4,29.9c0-0.2,0-0.4,0.1-0.6s0.2-0.3,0.3-0.5s0.3-0.2,0.5-0.3s0.4-0.1,0.6-0.1s0.5,0,0.7,0.1 s0.4,0.2,0.5,0.3s0.2,0.3,0.3,0.5s0.1,0.4,0.1,0.6s0,0.4-0.1,0.6s-0.2,0.3-0.3,0.5s-0.3,0.2-0.5,0.3s-0.4,0.1-0.7,0.1 s-0.5,0-0.6-0.1s-0.4-0.2-0.5-0.3s-0.2-0.3-0.3-0.5S23.4,30.1,23.4,29.9z M26.1,26.8h-2.3L23.4,17h3L26.1,26.8z"},child:[]}]})(t)}const vt=({user:t,fetchUserById:s})=>{var A,I,U,_,L,z,D;rt();const{updateUser:o,user:a}=lt(),[n,h]=d.useState(!1),[c,g]=d.useState((A=t==null?void 0:t.followers)==null?void 0:A.includes(a==null?void 0:a._id)),[w,j]=d.useState(!1),m=V(),x=(a==null?void 0:a._id)===(t==null?void 0:t._id),u=$({mutationFn:async l=>await o(l),onSuccess:()=>{h(!1),s(),P.success("Profile updated successfully!"),m.invalidateQueries(["user",t==null?void 0:t._id])},onError:l=>{var F,M;console.error("Profile update error:",l),P.error(((M=(F=l.response)==null?void 0:F.data)==null?void 0:M.message)||"Failed to update profile")}}),N=$({mutationFn:async()=>{const{data:l}=await mt.patch(`user/follow/${t==null?void 0:t._id}`);return l},onSuccess:l=>{g(l.isFollowing),s(),m.invalidateQueries(["user",t==null?void 0:t._id]),P.success(l.isFollowing?"Followed successfully":"Unfollowed successfully")},onError:l=>{var F,M;console.error("Error following/unfollowing user:",l),P.error(((M=(F=l.response)==null?void 0:F.data)==null?void 0:M.msg)||"Something went wrong. Please try again.")}}),v=async l=>{x&&u.mutate(l)},Y=async()=>{x||N.mutate()};return d.useEffect(()=>{t!=null&&t.followers&&(a!=null&&a._id)&&g(t.followers.includes(a._id))},[t==null?void 0:t.followers,a==null?void 0:a._id]),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 max-w-7xl mx-auto",children:[e.jsx("div",{className:"relative h-32 rounded-t-2xl overflow-hidden",children:e.jsx("img",{src:(t==null?void 0:t.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((t==null?void 0:t.username)||"Anonymous")}&background=random`,alt:"Profile",className:"w-full h-full object-cover rounded-t-2xl transform hover:scale-105 transition-transform duration-300"})}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex flex-col items-center -mt-12",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"p-1 rounded-full bg-white shadow-md hover:shadow-lg transition-shadow duration-300",children:[e.jsx("img",{src:(t==null?void 0:t.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((t==null?void 0:t.username)||"Anonymous")}&background=random`,alt:"Profile",className:"rounded-full w-24 h-24 border-4 border-white shadow-lg object-cover transform hover:scale-105 transition-transform duration-300"}),x?e.jsx("button",{onClick:()=>h(!0),className:"absolute bottom-0 right-0 bg-[var(--ternery)] text-white p-2 rounded-full shadow-lg hover:bg-[var(--secondary)] transition-colors duration-300",children:e.jsx(it,{className:"h-4 w-4"})}):e.jsxs("div",{className:"absolute bottom-0 right-0",children:[e.jsx("button",{onClick:Y,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),className:`p-2 rounded-full shadow-lg ${c?"bg-gray-200 text-gray-800 hover:bg-red-100 hover:text-red-600":"bg-[var(--ternery)] text-white hover:bg-[var(--secondary)]"} transition-all duration-300`,children:c?e.jsx(nt,{className:"h-4 w-4"}):e.jsx(ct,{className:"h-4 w-4"})}),w&&e.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-800 text-white text-xs rounded whitespace-nowrap z-50",children:[c?"Unfollow":"Follow",e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})]})]})}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-800 hover:text-[var(--ternery)] transition-colors duration-300",children:(t==null?void 0:t.name)||"Anonymous"})}),!x&&e.jsx("p",{className:"text-sm text-gray-500 font-medium hover:text-gray-700 transition-colors duration-300",children:c?"Following":"Not Following"})]}),e.jsxs("div",{className:"flex justify-center space-x-8 mt-4 border-y border-gray-100 py-3",children:[e.jsxs("div",{className:"text-center group cursor-pointer",children:[e.jsx("div",{className:"font-bold text-gray-800 group-hover:text-[var(--ternery)] transition-colors duration-300",children:((I=t==null?void 0:t.posts)==null?void 0:I.length)||0}),e.jsx("div",{className:"text-sm text-gray-500 group-hover:text-gray-700 transition-colors duration-300",children:"Posts"})]}),e.jsxs("div",{className:"text-center group cursor-pointer",children:[e.jsx("div",{className:"font-bold text-gray-800 group-hover:text-[var(--ternery)] transition-colors duration-300",children:((U=t==null?void 0:t.followers)==null?void 0:U.length)||0}),e.jsx("div",{className:"text-sm text-gray-500 group-hover:text-gray-700 transition-colors duration-300",children:"Followers"})]}),e.jsxs("div",{className:"text-center group cursor-pointer",children:[e.jsx("div",{className:"font-bold text-gray-800 group-hover:text-[var(--ternery)] transition-colors duration-300",children:((_=t==null?void 0:t.following)==null?void 0:_.length)||0}),e.jsx("div",{className:"text-sm text-gray-500 group-hover:text-gray-700 transition-colors duration-300",children:"Following"})]})]}),e.jsxs("div",{className:"mt-4 flex justify-center items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center text-center group cursor-pointer transform hover:scale-105 transition-all duration-300",children:[e.jsx(dt,{className:"text-pink-500 text-xl mb-1 group-hover:text-pink-600"}),e.jsx("div",{className:"text-sm font-semibold group-hover:text-[var(--ternery)]",children:((L=t==null?void 0:t.questions)==null?void 0:L.length)||0}),e.jsx("div",{className:"text-xs text-gray-500 group-hover:text-gray-700",children:"Questions Asked"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-center group cursor-pointer transform hover:scale-105 transition-all duration-300",children:[e.jsx(ut,{className:"text-blue-500 text-xl mb-1 group-hover:text-blue-600"}),e.jsx("div",{className:"text-sm font-semibold group-hover:text-[var(--ternery)]",children:((z=t==null?void 0:t.answers)==null?void 0:z.length)||0}),e.jsx("div",{className:"text-xs text-gray-500 group-hover:text-gray-700",children:"Answers Posted"})]}),(t==null?void 0:t.role)==="contributor"&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-center group cursor-pointer transform hover:scale-105 transition-all duration-300",children:[e.jsx(ht,{className:"text-purple-500 text-xl mb-1 group-hover:text-purple-600"}),e.jsx("div",{className:"text-sm font-semibold group-hover:text-[var(--ternery)]",children:((D=t==null?void 0:t.articles)==null?void 0:D.length)||0}),e.jsx("div",{className:"text-xs text-gray-500 group-hover:text-gray-700",children:"Articles Posted"})]})]})]}),n&&e.jsx(gt,{onClose:()=>h(!1),user:t,handleProfileUpdate:v})]})};export{vt as default};
