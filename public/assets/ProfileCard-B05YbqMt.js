var L=t=>{throw TypeError(t)};var O=(t,s,i)=>s.has(t)||L("Cannot "+i);var l=(t,s,i)=>(O(t,s,"read from private field"),i?i.call(t):s.get(t)),M=(t,s,i)=>s.has(t)?L("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,i),S=(t,s,i,a)=>(O(t,s,"write to private field"),a?a.call(t,i):s.set(t,i),i),k=(t,s,i)=>(O(t,s,"access private method"),i);import{aH as Y,aI as B,aJ as q,aK as G,aL as H,aM as J,r as h,aN as W,aO as X,j as e,k as A,_ as Q,aP as Z,c as tt,aQ as et,aR as st,w as at,h as it,t as E,f as $}from"./index-D4VtgvRl.js";var j,w,n,u,b,P,_,T,lt=(T=class extends Y{constructor(s,i){super();M(this,b);M(this,j);M(this,w);M(this,n);M(this,u);S(this,j,s),this.setOptions(i),this.bindMethods(),k(this,b,P).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const i=this.options;this.options=l(this,j).defaultMutationOptions(s),B(this.options,i)||l(this,j).getMutationCache().notify({type:"observerOptionsUpdated",mutation:l(this,n),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&q(i.mutationKey)!==q(this.options.mutationKey)?this.reset():((a=l(this,n))==null?void 0:a.state.status)==="pending"&&l(this,n).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=l(this,n))==null||s.removeObserver(this)}onMutationUpdate(s){k(this,b,P).call(this),k(this,b,_).call(this,s)}getCurrentResult(){return l(this,w)}reset(){var s;(s=l(this,n))==null||s.removeObserver(this),S(this,n,void 0),k(this,b,P).call(this),k(this,b,_).call(this)}mutate(s,i){var a;return S(this,u,i),(a=l(this,n))==null||a.removeObserver(this),S(this,n,l(this,j).getMutationCache().build(l(this,j),this.options)),l(this,n).addObserver(this),l(this,n).execute(s)}},j=new WeakMap,w=new WeakMap,n=new WeakMap,u=new WeakMap,b=new WeakSet,P=function(){var i;const s=((i=l(this,n))==null?void 0:i.state)??G();S(this,w,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},_=function(s){H.batch(()=>{var i,a,r,d,x,g,N,C;if(l(this,u)&&this.hasListeners()){const c=l(this,w).variables,y=l(this,w).context;(s==null?void 0:s.type)==="success"?((a=(i=l(this,u)).onSuccess)==null||a.call(i,s.data,c,y),(d=(r=l(this,u)).onSettled)==null||d.call(r,s.data,null,c,y)):(s==null?void 0:s.type)==="error"&&((g=(x=l(this,u)).onError)==null||g.call(x,s.error,c,y),(C=(N=l(this,u)).onSettled)==null||C.call(N,void 0,s.error,c,y))}this.listeners.forEach(c=>{c(l(this,w))})})},T);function z(t,s){const i=J(),[a]=h.useState(()=>new lt(i,t));h.useEffect(()=>{a.setOptions(t)},[a,t]);const r=h.useSyncExternalStore(h.useCallback(x=>a.subscribe(H.batchCalls(x)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=h.useCallback((x,g)=>{a.mutate(x,g).catch(W)},[a]);if(r.error&&X(a.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:d,mutateAsync:r.mutate}}const ot=({onClose:t,user:s,handleProfileUpdate:i})=>{const[a,r]=h.useState(!1),[d,x]=h.useState((s==null?void 0:s.avatar)||null),g=h.useRef(null),N=async f=>{f.preventDefault(),r(!0);const F=new FormData(f.target);try{const v=await i(F);window.location.reload()}catch(v){console.log({errorInModel:v})}finally{r(!1)}},C=f=>{const F=f.target.files[0];if(F){const v=new FileReader;v.onloadend=()=>{x(v.result)},v.readAsDataURL(F)}},c=()=>{var f;(f=g.current)==null||f.click()},y=e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all relative z-50",children:[e.jsx("button",{onClick:t,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{className:"px-6 sm:px-8 py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-[var(--grey--900)]",children:"Update Your Profile"}),e.jsx("p",{className:"text-[var(--grey--800)] mt-2",children:"Customize your profile information"})]}),e.jsxs("form",{method:"post",encType:"multipart/form-data",className:"space-y-6",onSubmit:N,children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{onClick:c,className:"relative group cursor-pointer",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-[var(--primary)] shadow-lg",children:d?e.jsx("img",{src:d,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(Q,{className:"w-12 h-12 text-gray-400"})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsx("input",{ref:g,type:"file",name:"avatar",className:"hidden",accept:"image/*",onChange:C})]}),e.jsx("p",{className:"text-sm text-[var(--grey--800)] mt-2",children:"Click to change profile picture"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"name",required:!0,className:"p-2 bg-[var(--body)] rounded-lg text-black  border border-gray-300 focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent transition-all pl-10",placeholder:"Enter your full name",defaultValue:s==null?void 0:s.name}),e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",disabled:a,children:[e.jsx(A,{className:"w-4 h-4"}),"Cancel"]}),e.jsx("button",{type:"submit",className:`btn-2 relative flex items-center gap-2 ${a?"cursor-not-allowed opacity-70":""}`,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4"}),"Update Profile"]})})]})]})]})]})});return st.createPortal(y,document.body)},ct=({user:t,fetchUserById:s})=>{var R,I,U,D,K;const{updateUser:i,user:a}=at(),[r,d]=h.useState(!1),[x,g]=h.useState((R=t==null?void 0:t.followers)==null?void 0:R.includes(a==null?void 0:a._id)),N=J(),C=it(),c=(a==null?void 0:a._id)===(t==null?void 0:t._id),y=z({mutationFn:async o=>await i(o),onSuccess:()=>{d(!1),s(),E.success("Profile updated successfully!"),N.invalidateQueries(["user",t==null?void 0:t._id])},onError:o=>{var p,m;E.error(((m=(p=o.response)==null?void 0:p.data)==null?void 0:m.message)||"Failed to update profile")}}),f=z({mutationFn:async()=>{const{data:o}=await $.patch(`user/follow/${t==null?void 0:t._id}`);return o},onSuccess:o=>{g(o.isFollowing),s(),N.invalidateQueries(["user",t==null?void 0:t._id]),E.success(o.isFollowing?"Followed successfully":"Unfollowed successfully")},onError:o=>{var p,m;E.error(((m=(p=o.response)==null?void 0:p.data)==null?void 0:m.msg)||"Something went wrong. Please try again.")}}),F=o=>{c&&y.mutate(o)},v=()=>{c||f.mutate()},V=async()=>{var o,p;try{const{data:m}=await $.post("chats",{_userId:t._id});console.log({data:m}),C(`/chats/${m._id}`)}catch(m){console.error("Error sending message:",m),E.error(((p=(o=m.response)==null?void 0:o.data)==null?void 0:p.msg)||"Failed to send message")}};return h.useEffect(()=>{t!=null&&t.followers&&(a!=null&&a._id)&&g(t.followers.includes(a._id))},[t==null?void 0:t.followers,a==null?void 0:a._id]),e.jsxs("div",{className:" mx-auto bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start",children:[e.jsx("img",{src:(t==null?void 0:t.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((t==null?void 0:t.username)||"Anonymous")}`,alt:"Profile",className:"w-24 h-24 rounded-full object-cover ring-2 ring-gray-100"}),e.jsxs("div",{className:"mt-4 text-center md:text-left",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:t==null?void 0:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Mental Health Expert"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:((I=t==null?void 0:t.counts)==null?void 0:I.totalPosts)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Posts"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:((U=t==null?void 0:t.articles)==null?void 0:U.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Articles"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:((D=t==null?void 0:t.questions)==null?void 0:D.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Questions"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:((K=t==null?void 0:t.answers)==null?void 0:K.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Answers"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[c?e.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Edit Profile"}):e.jsx("button",{onClick:v,className:"px-6 py-2 text-sm font-medium text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors",children:x?"Unfollow":"Follow"}),e.jsx("button",{onClick:V,className:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Message"})]})]})]}),r&&e.jsx(ot,{onClose:()=>d(!1),user:t,handleProfileUpdate:F})]})};export{ct as default};
