import{w as C,r as v,a as w,b as P,R as F,j as t,c as y,f as h,t as n}from"./index-DpAI_xRw.js";import E from"./ArticleCommentCard-upMg6uR5.js";import"./ArticleCommentReply-Dg1E4v1s.js";const $=({articleId:s})=>{const{user:r}=C(),[a,u]=v.useState(""),{ref:N,inView:d}=w(),{data:o,fetchNextPage:p,hasNextPage:m,isFetchingNextPage:c,status:x,refetch:f}=P({queryKey:["articleComments",s],queryFn:async({pageParam:e=1})=>(await h.get(`/articles/${s}/comments?page=${e}&limit=10`)).data,getNextPageParam:e=>{if(e.currentPage<e.totalPages)return e.currentPage+1},refetchOnWindowFocus:!1}),j=async e=>{var l,g;if(e.preventDefault(),!r){n.error("Please login to comment!");return}if(!a.trim()){n.error("Comment cannot be empty!");return}try{await h.post(`/articles/${s}/comments`,{content:a}),u(""),f(),n.success("Comment added successfully!")}catch(b){n.error(((g=(l=b.response)==null?void 0:l.data)==null?void 0:g.msg)||"Failed to add comment")}};if(F.useEffect(()=>{d&&m&&!c&&p()},[d,p,m,c]),x==="loading")return t.jsx("div",{className:"flex justify-center items-center py-4",children:t.jsx(y,{className:"animate-spin h-6 w-6 text-primary"})});if(x==="error")return t.jsx("div",{className:"text-center text-red-500 py-4",children:"Error loading comments"});const i=(o==null?void 0:o.pages.flatMap(e=>e.comments))||[];return t.jsxs("div",{className:"mt-8",children:[t.jsxs("form",{onSubmit:j,className:"mb-6",children:[t.jsx("textarea",{value:a,onChange:e=>u(e.target.value),placeholder:r?"Write your comment...":"Please login to comment",className:"w-full p-3 pr-14 border border-gray-100 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent resize-none text-gray-700",rows:"3",disabled:!r}),t.jsx("button",{type:"submit",disabled:!r,className:"btn-2 mt-2",children:"Post Comment"})]}),t.jsxs("div",{className:"space-y-4",children:[i.map(e=>t.jsx(E,{comment:e,articleId:s,onCommentUpdate:f},e._id)),t.jsxs("div",{ref:N,className:"py-4 text-center",children:[c&&t.jsx(y,{className:"animate-spin h-6 w-6 mx-auto text-primary"}),!m&&i.length>0&&t.jsx("p",{className:"text-gray-500",children:"No more comments"})]}),i.length===0&&t.jsx("p",{className:"text-center text-gray-500 py-4",children:"No comments yet. Be the first to comment!"})]})]})};export{$ as default};
